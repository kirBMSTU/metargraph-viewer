"use strict";(self.webpackChunkmetagraph_viewer=self.webpackChunkmetagraph_viewer||[]).push([[808],{2575:function(e,r,t){t.r(r);var n=t(4165),o=t(5861),i=t(5671),a=t(3144),l=t(2791),u=t(1250),c=t(885),d="Toolbar_root__LlMrG",s="Toolbar_pair__j4DXd",h=t(9023),g=t(4098),v=new((0,a.Z)((function e(){var r=this;(0,i.Z)(this,e),this.colorVertex=localStorage.getItem("colorVertex")||"#444",this.colorEdge=localStorage.getItem("colorEdge")||"yellow",this.colorBackground=localStorage.getItem("colorBackground")||"#ddd",this.setColorVertex=function(e){r.colorVertex=e,localStorage.setItem("colorVertex",e)},this.setColorEdge=function(e){r.colorEdge=e,localStorage.setItem("colorEdge",e)},this.setColorBackground=function(e){r.colorBackground=e,localStorage.setItem("colorBackground",e)},(0,g.ky)(this)}))),f=l.createContext(v),p=function(){return(0,l.useContext)(f)},m=v,x=t(184),k=(0,h.Pi)((function(){var e=p(),r=e.colorBackground,t=e.colorVertex,n=e.colorEdge,o=e.setColorBackground,i=e.setColorEdge,a=e.setColorVertex,u=(0,l.useState)(r),h=(0,c.Z)(u,2),g=h[0],v=h[1],f=(0,l.useState)(t),m=(0,c.Z)(f,2),k=m[0],y=m[1],w=(0,l.useState)(n),Z=(0,c.Z)(w,2),b=Z[0],_=Z[1];return(0,x.jsxs)("div",{className:d,children:[(0,x.jsxs)("span",{className:s,children:[(0,x.jsx)("label",{htmlFor:"edge-color",children:"\u0426\u0432\u0435\u0442 \u0440\u0435\u0431\u0435\u0440"}),(0,x.jsx)("input",{type:"color",id:"edge-color",value:b,onChange:function(e){return _(null===e||void 0===e?void 0:e.target.value)},onBlur:function(){return i(b)}})]}),(0,x.jsxs)("span",{className:s,children:[(0,x.jsx)("label",{htmlFor:"vertex-color",children:"\u0426\u0432\u0435\u0442 \u0432\u0435\u0440\u0448\u0438\u043d"}),(0,x.jsx)("input",{type:"color",id:"vertex-color",value:k,onChange:function(e){return y(null===e||void 0===e?void 0:e.target.value)},onBlur:function(){return a(k)}})]}),(0,x.jsxs)("span",{className:s,children:[(0,x.jsx)("label",{htmlFor:"background-color",children:"\u0426\u0432\u0435\u0442 \u0444\u043e\u043d\u0430"}),(0,x.jsx)("input",{type:"color",id:"background-color",value:g,onChange:function(e){return v(null===e||void 0===e?void 0:e.target.value)},onBlur:function(){return o(g)}})]})]})})),y=t(2982),w=t(1413),Z=t(2253),b=t(6095),_=function(e){return"string"===typeof e?e:String(e.id)},N=function(){function e(r){var t=this;(0,i.Z)(this,e),this._graphModel=null,this._expandedNodes=new Set,this.setGraphData=function(e){t._graphModel=Z.parse(b.UndirectedGraph,e)},this.expandNode=function(e){t._expandedNodes.add(String(e.id))},this.isExpanded=function(e){return t._expandedNodes.has(e)},this.getNested=function(e){var r,n,o=(null!==(r=t.allVertices.filter((function(r){var n=r.node.match(/(.*)::.*/)||[],o=(0,c.Z)(n,2)[1];return Boolean(o===e.id)&&t.isExpanded(o)})))&&void 0!==r?r:[]).map((function(e){var r=e.node,t=e.attributes;return(0,w.Z)((0,w.Z)({},t),{},{id:r})}));return{links:null!==(n=t.allEdges.filter((function(e){return o.find((function(r){return r.id===_(null===e||void 0===e?void 0:e.source)}))&&o.find((function(r){return r.id===_(null===e||void 0===e?void 0:e.target)}))})))&&void 0!==n?n:[],nodes:o}},(0,g.rC)(this,{_expandedNodes:g.LO,_graphModel:g.LO.ref,expandNode:g.aD.bound,setGraphData:g.aD.bound,vertices:g.Fl,edges:g.Fl,graphDataNormalized:g.Fl}),r&&this.setGraphData(r)}return(0,a.Z)(e,[{key:"allVertices",get:function(){var e,r;return(0,y.Z)(null!==(e=null===(r=this._graphModel)||void 0===r?void 0:r.nodeEntries())&&void 0!==e?e:[])}},{key:"vertices",get:function(){var e=this;return this.allVertices.filter((function(r){var t=r.node.match(/(.*)::.*/);if(!Boolean(t))return!0;var n=t||[],o=(0,c.Z)(n,2)[1];return e._expandedNodes.has(o)}))}},{key:"allEdges",get:function(){var e,r;return(0,y.Z)(null!==(e=null===(r=this._graphModel)||void 0===r?void 0:r.edgeEntries())&&void 0!==e?e:[])}},{key:"edges",get:function(){var e=this;return this.allEdges.filter((function(r){var t=e.vertices.some((function(e){return e.node===_(r.source)}));return e.vertices.some((function(e){return e.node===_(r.target)}))&&t})).filter((function(r){var t,n,o,i,a=null===(t=(n=_(null===r||void 0===r?void 0:r.source)).match)||void 0===t?void 0:t.call(n,/(.*)::.*/),l=null===(o=(i=_(null===r||void 0===r?void 0:r.target)).match)||void 0===o?void 0:o.call(i,/(.*)::.*/),u=Boolean(a),d=Boolean(l);if(!u&&!d)return!0;var s=a||[],h=(0,c.Z)(s,2)[1],g=l||[],v=(0,c.Z)(g,2)[1];return(e._expandedNodes.has(h)||!h)&&(e._expandedNodes.has(v)||!v)}))}},{key:"maxExpandedNestedLevel",get:function(){return Math.max.apply(Math,(0,y.Z)((0,y.Z)(this._expandedNodes).map((function(e){return e.split("::").length}))))+1}},{key:"graphDataNormalized",get:function(){return{nodes:this.vertices.map((function(e){var r=e.node,t=e.attributes;return(0,w.Z)((0,w.Z)({},t),{},{id:r})})),links:this.edges}}},{key:"destroy",value:function(){}}]),e}(),S=l.createContext(void 0),E=N,j=t(32),B=t(7821),C=t(7760),D=t(540),M=["green","green","red","purple","yellow","lightblue"],V=function(e){return M[e%M.length]},F=function(e){return String("string"===typeof e?e:e.id).split("::").length};var P,z=(0,j.Pi)((function(){var e=(0,l.useRef)(),r=p(),t=r.colorBackground,n=r.colorVertex,o=r.colorEdge,i=function(){var e=l.useContext(S);return void 0===e?(console.warn("Metagraph Viewer: GraphStore instance was not provided into context"),{}):e}(),a=i.expandNode,u=i.getNested,d=i.graphDataNormalized,s=i.maxExpandedNestedLevel;return(0,l.useEffect)((function(){var r=e.current;r&&(r.d3Force("charge",D.q5i().strength((function(e){e.id.match(/(.*)::.*/);return-1500}))),r.d3Force("center",function(){var e;function r(r){var t;null===(t=e)||void 0===t||t.forEach((function(t){var n,o=(null===(n=String(t.id))||void 0===n?void 0:n.match(/(.*)::.*/))||[],i=(0,c.Z)(o,2)[1],a=e.find((function(e){return e.id===i}));if(a){var l=.7*r;t.x+=(a.x-t.x)*l,t.y+=(a.y-t.y)*l,t.z+=(a.z-t.z)*l}}))}return r.initialize=function(r){e=r},r}()),r.d3Force("link").distance((function(e){var r=e.source,t=e.target,n=u(r),o=Boolean(n.nodes.length),i=u(t),a=Boolean(i.nodes.length),l=F(r),c=F(r),d=s-Math.max(l,c);return o||a?300*d:10})))}),[e.current]),(0,x.jsx)(B.Z,{ref:e,numDimensions:3,nodeLabel:"id",linkLabel:"edge",graphData:d,linkOpacity:1,linkColor:function(e){var r=e.source,t=e.target,n=F(r),i=n>1,a=F(t),l=a>1,u=Math.max(n,a)-1;return i||l?V(u):o},backgroundColor:t,linkWidth:1,linkDirectionalParticleWidth:6,onNodeClick:a,showNavInfo:!1,linkDirectionalParticles:function(){return 10},nodeThreeObject:function(e){var r=u(e),t=Boolean(r.nodes.length),o=F(e),i=t?200*(s-o):15,a=t?.13:1,l=o>1?V(o-1):n,c=new C.xo$(i,32,16),d=new C.vBJ({color:l,opacity:a,transparent:t,wireframe:t});return new C.Kj0(c,d)}})}));!function(e){e.library="library",e.demo="demo"}(P||(P={}));var I,L=(0,h.Pi)((function(e){var r=e.mode,t=e.graphString,n=function(e){var r=(0,l.useRef)();return r.current||(r.current=e()),(0,l.useEffect)((function(){return function(){var e;return null===(e=r.current)||void 0===e?void 0:e.destroy()}}),[]),r.current}((function(){return new E(t)}));return(0,x.jsx)(f.Provider,{value:m,children:(0,x.jsxs)(S.Provider,{value:n,children:[r===P.demo&&(0,x.jsx)(k,{}),(0,x.jsx)(z,{})]})})}));!function(e){e.graphmlUrl="graphml-url",e.graphmlString="graphml-string"}(I||(I={}));var G=function(){function e(r){(0,i.Z)(this,e),this._params=void 0,this.id=Date.now()*Math.random(),this._params=r,!1!==r.initialRender&&this.render()}return(0,a.Z)(e,[{key:"graphData",get:function(){var e=this._params.data;return function(e){return e.type===I.graphmlString}(e)?Promise.resolve(e.str):function(e){return e.type===I.graphmlUrl}(e)?fetch(e.url).then((function(e){return e.text()})):Promise.reject("Metagraph Viewer: unknown type of data: ".concat(e))}},{key:"render",value:function(){var e=(0,o.Z)((0,n.Z)().mark((function e(){var r,t,o,i,a,l,c;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this._params,t=r.containerEl,o=r.containerSelector,i=r.mode,a=void 0===i?P.library:i,l=t||o&&document.querySelector(o)){e.next=5;break}return console.warn("Metagraph Viewer: containerEl or containerSelector must be provided!,\n                but given ".concat(t,", ").concat(o," for graph with id=").concat(this.id)),e.abrupt("return");case 5:return e.next=7,this.graphData;case 7:c=e.sent,(0,u.s)(l).render((0,x.jsx)(L,{mode:a,graphString:c}));case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}();G.DataSourceKind=I;var O=G;window.MetagraphViewer=O,window.MV=O}}]);
//# sourceMappingURL=mv.js.map